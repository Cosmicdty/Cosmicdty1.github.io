<html>
<head>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
</head>
<body>
Make sure to run this via a server

<br>
<button id="start_stream_button">Start Video Stream</button>

<br>
<video id="video" style="width: 300px;" autoplay></video>
<br>  <br>
<button onclick="predict()">Predict</button>
<br>
<p id="result"> </p>

<script>
  const startStreamButton = document.getElementById('start_stream_button');
  const video = document.getElementById('video');

  startStreamButton.onclick = async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      video.srcObject = stream;
    } catch (error) {
      console.error('Error accessing video stream:', error);
    }
  };

  async function predict() {
    const model = await tf.loadGraphModel('./model.json');

    const example = tf.browser.fromPixels(video).cast('float32');
    const expandedExample = example.expandDims(); // Expand dimensions to match model input shape

    const prediction = await model.predict(expandedExample);
    const classScores = await prediction.data();
    const maxScoreId = classScores.indexOf(Math.max(...classScores));
    const classes = ["Google pixel 6 pro", "Google pixel 7 pro", "iPhone 14 pro max", "iPhone XS max"];
    const classNames = ["blue", "red", "green", "yellow"];

    console.log(classScores);
    document.getElementById("result").innerHTML = classes[maxScoreId].toString();

    // Change background color based on the predicted label
    document.body.style.backgroundColor = classNames[maxScoreId];
  }
</script>
</body>
</html>
